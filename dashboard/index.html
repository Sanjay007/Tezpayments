<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
    <title>Tezpayments</title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;800&display=swap" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../assets/css/style.min.css" />
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="../assets/css/material-dashboard.css" rel="stylesheet" />
    <style>
      /* .navbar-vertical.navbar-expand-xs {
        max-width: 25rem !important;
      } */
      .sidenav .collapse .nav-item .nav-link.active {
        color: hsl(0, 0%, 0%) !important;
      }
      .sidenav .collapse .nav-item .nav-link.active i {
        color: #f55621 !important;
      }
    </style>
  </head>

  <body class="g-sidenav-show" style="background: url('../images/bg-dashboard.jpg')">
    <aside
      class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-white"
      id="sidenav-main"
    >
      <div class="sidenav-header">
        <i
          class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
          aria-hidden="true"
          id="iconSidenav"
          style="z-index: 33; font-size: 1.6rem"
        ></i>

        <a class="navbar-brand m-0" href="#" target="_blank">
          <span class="ms-1 font-weight-bold text-center">
            <img src="../images/logo.png" alt="" />
          </span>
        </a>
      </div>
      <hr class="horizontal light mt-0 mb-2" />
      <div class="collapse navbar-collapse w-auto max-height-vh-100" id="sidenav-collapse-main">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link text-white active" href="index.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">home</i>
              </div>
              <span class="nav-link-text ms-1">Home</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="profile.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">person</i>
              </div>
              <span class="nav-link-text ms-1">Profile</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="./pages/tables.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">discount</i>
              </div>
              <span class="nav-link-text ms-1">Discount Management</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="./pages/tables.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <img src="/images/icons/main-wallet.png" alt="" />
              </div>
              <span class="nav-link-text ms-1">Wallet Management</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="./pages/tables.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <img src="/images/icons/disput-managementt.png" alt="" />
              </div>
              <span class="nav-link-text ms-1">Disput Management</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="./pages/tables.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <img src="/images/icons/view-bank-details.png" alt="" />
              </div>
              <span class="nav-link-text ms-1">View Bank Details</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="./pages/tables.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <img src="/images/icons/reports.png" alt="" />
              </div>
              <span class="nav-link-text ms-1">Reports</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-dark" href="./pages/tables.html">
              <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
                <img src="/images/icons/latest-transaction.png" alt="" />
              </div>
              <span class="nav-link-text ms-1">Latest Transactions</span>
            </a>
          </li>
        </ul>
      </div>
    </aside>
    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
      <!-- Navbar -->
      <nav
        class="navbar navbar-main navbar-expand-lg px-0 mx-4 mt-3 shadow-none border-radius-xl bg-white header-bashboard"
        id="navbarBlur"
        navbar-scroll="true"
      >
        <div class="container-fluid py-1 px-3 d-flex justify-content-between">
          <!-- Main Menu Right Side Content -->
          <nav class="d-flex justify-content-start align-items-center">
            <ul class="d-flex px-0 py-0 m-0">
              <li class="nav-item d-flex align-items-center">
                <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                  <div class="sidenav-toggler-inner">
                    <i class="sidenav-toggler-line"></i>
                    <i class="sidenav-toggler-line"></i>
                    <i class="sidenav-toggler-line"></i>
                  </div>
                </a>
              </li>
              <li>
                <h6 class="font-weight-bolder mb-0 ps-3 title-header dashboard-title">Dashboard</h6>
              </li>
              <li></li>
            </ul>
            <div class="ps-5 d-flex align-items-center search-filed">
              <div class="input-group border-radius-xl position-relative">
                <i class="material-icons opacity-10 search-icon position-absolute" id="searchicon">search</i>
                <div class="input-wrapper" id="searchinput">
                  <input type="text" class="form-control" placeholder="Search" />
                  <i class="material-icons opacity-10 search-icon position-absolute" id="closeinput">close</i>
                </div>
              </div>
            </div>
          </nav>
          <!-- Header Right Side Content -->
          <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4 d-flex align-items-center" id="navbar">
            <ul class="navbar-nav ml-auto right-sidepart-header" style="margin-left: auto">
              <li class="nav-item dropdown pe-2 d-flex align-items-center notification-icon">
                <a
                  href="javascript:;"
                  class="nav-link text-body p-0"
                  id="dropdownMenuButton"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fa fa-bell cursor-pointer"></i>
                </a>
              </li>
              <!-- User Profile -->
              <li class="nav-item pe-2 d-flex align-items-center ps-1 user-profile">
                <div class="flex_wrapper d-flex justify-content-start align-items-center">
                  <div class="user-avtar rounded-circle">
                    <img src="../images/icons/avtar.png" class="img-fluid" alt="" />
                  </div>
                  <div class="user-details">
                    <h2 class="mb-0">Nilanjan Dutta</h2>
                    <h5>ndnilanjandutta1@gmail.com</h5>
                  </div>
                </div>
              </li>
              <!-- Wallet Balence -->
              <li class="nav-item dropdown pe-2 d-flex align-items-center ps-1 wallet-balence">
                <a
                  href="javascript:;"
                  class="nav-link text-body p-0"
                  id="dropdownMenuButton"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <img src="../images/wallet-balence.png" class="main-walletimg" alt="" />
                </a>
                <ul
                  class="dropdown-menu dropdown-menu-end px-2 py-3 me-sm-n4 wallet-balence-dropdown"
                  aria-labelledby="dropdownMenuButton"
                >
                  <li class="mb-2">
                    <a class="dropdown-item border-radius-md" href="javascript:;">
                      <div class="flex_wrapper d-flex justify-content-between align-items-center">
                        <div class="wallet-options">
                          <div class="inner-flex d-flex align-items-center">
                            <div class="wallet-icon">
                              <img src="../images/icons/main-wallet.png" alt="" />
                            </div>
                            <div class="wallet-name">
                              <span>main</span>
                              <h4>Wallet</h4>
                            </div>
                          </div>
                        </div>
                        <div class="balence-show"><h3>Rs.14588.00</h3></div>
                      </div>
                    </a>
                  </li>
                  <!-- AEPS Wallet -->
                  <li class="mb-2">
                    <a class="dropdown-item border-radius-md" href="javascript:;">
                      <div class="flex_wrapper d-flex justify-content-between align-items-center">
                        <div class="wallet-options">
                          <div class="inner-flex d-flex align-items-center">
                            <div class="wallet-icon">
                              <img src="../images/icons/main-wallet.png" alt="" />
                            </div>
                            <div class="wallet-name">
                              <span>AEPS</span>
                              <h4>Wallet</h4>
                            </div>
                          </div>
                        </div>
                        <div class="balence-show"><h3>Rs.14588.00</h3></div>
                      </div>
                    </a>
                  </li>
                  <!-- Your Profile -->
                  <li class="mb-2 flex_wrapper d-flex justify-content-between align-items-center">
                    <a class="dropdown-item border-radius-md" href="javascript:;">
                      <div class="wallet-options">
                        <div class="inner-flex d-flex align-items-center">
                          <div class="wallet-icon">
                            <img src="../images/icons/profile-icon.png" alt="" />
                          </div>
                          <div class="wallet-name">
                            <span>Your</span>
                            <h4>Profile</h4>
                          </div>
                        </div>
                      </div>
                    </a>
                    <a class="dropdown-item sign-out d-flex justify-content-end" href="javascript:;">
                      <img src="../images/icons/sign-out.png" alt="" /> Sign Out</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <!-- Main Content Pannel Start -->
      <div class="container-fluid py-4">
        <div class="row">
          <div class="col-12">
            <div
              class="pannel-content min-height-vh-100 h-100 border-radius-lg bg-white"
              style="border-bottom-left-radius: 0; border-bottom-right-radius: 0"
            >
              <!-- Modal Services Start -->
              <div class="modal-services d-none">
                <div class="modal-content">
                  <div class="container">
                    <div class="row border-bottom header-content">
                      <div class="col-md-8">
                        <div class="services-name-dy">
                          <h4></h4>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="powered-by d-flex align-items-center">
                          <span>powered by:</span>
                          <img
                            src="https://static.mobikwik.com/appdata/operator_icons/bbps.png"
                            class="img-fluid"
                            alt=""
                          />
                        </div>
                      </div>
                    </div>

                    <div class="main-content">
                      <form onsubmit="formSubmit(event)" action="#" class="row">
                        <div class="row">
                          <div class="form-group col-md-4" id="billerRoot">
                            <label>Biller</label>
                            <select name="billerRoot" onchange="billerRootSelected(this)" class="form-control"></select>
                          </div>
                        </div>
                        <div class="row d-none mb-5" id="mobileRechargeCol">
                          <div class="form-group col-md-4" id="mobileBillerRootType">
                            <label>Biller Type</label>
                            <select
                              name="mobileBillerRootType"
                              onchange="billerRootTypeSelected(this)"
                              class="form-control"
                            ></select>
                          </div>
                          <div class="form-group col-md-4 d-none" id="mobileRechargePlans">
                            <label>Plan Type</label>
                            <select name="mobileRechargePlans" class="form-control"></select>
                          </div>
                          <div class="form-group col-md-4" id="mobileRechargeCircle">
                            <label>Circle</label>
                            <select name="mobileRechargeCircle" class="form-control"></select>
                          </div>
                          <div class="form-group col-md-4">
                            <a class="btn" href="#" onclick="fetchplans()">Fetch Plans</a>
                          </div>
                        </div>
                        <div class="row d-none mb-5" id="plansList"></div>
                        <div class="row d-none mb-5 mt-5" id="billList"></div>
                        <div class="row d-none mb-5 mt-5" id="educationList">
                          <div class="col-md-4" id="statesList">
                            <label>Select State</label>
                            <select onchange="stateSelected()" name="statesList" class="form-control"></select>
                          </div>
                          <div class="col-md-4" id="citiesList">
                            <label>Select City</label>
                            <select onchange="citySelected()" name="citiesList" class="form-control"></select>
                          </div>
                          <div class="col-md-4" id="schoolsList">
                            <label>Select School</label>
                            <select onchange="schoolSelected()" name="schoolsList" class="form-control"></select>
                          </div>
                        </div>
                        <div id="fields" class="row"></div>
                        <div class="row">
                          <div class="col-md-12 border-top mt-5">
                            <button id="bbps-submit-btn" type="submit" name="submit" class="border-0 btn">
                              Fetch Bill
                            </button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Modal Services End -->

              <div class="home_wrapper">
                <!-- Banking Services Start -->
                <div class="sevices-row banking-services pt-5">
                  <h2 class="title-dashboard">Banking Services</h2>
                  <div class="services-wrapper">
                    <!-- Dynamic Data Fetching -->
                    <ul class="d-flex ml-0 p-0" id="services-wrapper"></ul>
                  </div>
                </div>
                <!-- Recharge & BBPS Services Start -->
                <div class="sevices-row banking-services bbps-services">
                  <h2 class="title-dashboard">Recharge & BBPS Services</h2>
                  <div class="services-wrapper">
                    <ul class="d-flex ml-0 p-0" id="rechangeandbbps"></ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Main Content Pannel Start -->
        <!-- Footer Start -->
        <footer
          class="footer py-4 border-radius-lg text-center"
          style="background: white; border-top-left-radius: 0; border-top-right-radius: 0"
        >
          <div class="container-fluid">
            <p style="color: #9f9ea4">Copyright © 2021 Tezpayments. All rights reserved.</p>
          </div>
        </footer>
        <!-- Footer End -->
      </div>
    </main>

    <!--   Core JS Files   -->

    <script src="../assets/js/core/bootstrap.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

    <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/hmac-sha256.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/enc-base64.min.js"></script>

    <script>
      var win = navigator.platform.indexOf("Win") > -1;
      if (win && document.querySelector("#sidenav-scrollbar")) {
        var options = {
          damping: "0.5",
        };
        Scrollbar.init(document.querySelector("#sidenav-scrollbar"), options);
      }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="../assets/js/material-dashboard.min.js?v=3.0.2"></script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script src="../assets/js/dataJSON.js"></script>
    <script src="../assets/js/education.js"></script>
    <script>
      var searchicon = document.getElementById("searchicon");
      var searchinput = document.getElementById("searchinput");
      searchicon.addEventListener("click", function () {
        searchinput.classList.add("showinputwrapper");
      });
      var closeinput = document.getElementById("closeinput");
      closeinput.addEventListener("click", function () {
        searchinput.classList.remove("showinputwrapper");
      });
    </script>
    <script>
      var mainContent = document.querySelector(".main-content");
      var sidenavMain = document.querySelector("#sidenav-main");
      var humb = document.getElementById("iconNavbarSidenav");
      humb.addEventListener("click", function () {
        mainContent.classList.toggle("addtoggleMainContent");
        sidenavMain.classList.toggle("hideshowsidebar");
      });
    </script>

    <script>
      $(document).ready(function () {
        console.log(education, states);
        $.each(banking, function (key, val) {
          document.querySelector("#services-wrapper").innerHTML += `    
          <li class="text-center">
            <a href="#">
               <div class="services-icons">
                  <img src="${val.s_img}" alt=""/>
                </div>
                <h4 class="services-title">${val.name}</h4>
            </a>
          </li>   
        `;
        });
        $.each(rechargeandbpps, function (key, val) {
          document.querySelector("#rechangeandbbps").innerHTML += `
             <li class="text-center">
                <a href="#" onclick="getService('${val.id}')">
                  <div class="services-icons">
                     <img src="${val.s_img}" alt=""/>
                    </div>
                  <h4 class="services-title">${val.name}</h4>
                </a>
              </li>
          `;
        });

        let html = "";
        for (var i = 0; i < mobileRechargeCircles.length; i++) {
          let item = mobileRechargeCircles[i];
          html += `<option value="${item.cId}">${item.state}</option>`;
        }
        document.querySelector("#mobileRechargeCircle select").innerHTML = html;

        html = "";
        for (var i = 0; i < mobileRechargePlans.length; i++) {
          let item = mobileRechargePlans[i];
          html += `<option value="${item.pId}">${item.planName}</option>`;
        }
        document.querySelector("#mobileRechargePlans select").innerHTML = html;
      });
    </script>

    <!-- Variables -->
    <script>
      let services,
        service_id,
        billerRootIndex,
        billerRootTypeIndex = "0",
        rechargePlans = [],
        selectedPlanIndex,
        bills = [];
    </script>
    <!-- Setup form -->
    <script>
      async function setBillerRoot(service) {
        let html = "";
        for (var i = 0; i < service.billerRoot.length; i++) {
          let item = service.billerRoot[i];
          html += `<option value="${i}">${item.name}</option>`;
        }
        document.querySelector("#billerRoot select").innerHTML = html;
        if (service_id === "mobile") document.querySelector("#bbps-submit-btn").innerHTML = "Recharge";
      }
      async function billerRootSelected() {
        let value = document.querySelector("#billerRoot select").value;
        billerRootIndex = value;
        if (service_id === "mobile") {
          let html = "";
          let items = services.billerRoot[value].billers;
          for (var i = 0; i < items.length; i++) {
            let item = items[i];
            html += `<option value="${i}">${item.type}</option>`;
          }
          document.querySelector("#mobileBillerRootType select").innerHTML = html;
          document.querySelector("#mobileRechargeCol").classList.remove("d-none");
        }
        if (service_id === "dth") fetchplans("dth");
        setFields();
        return true;
      }
      async function billerRootTypeSelected() {
        let value = document.querySelector("#mobileBillerRootType select").value;
        billerRootTypeIndex = value;
        setFields();
        return true;
      }
      async function setFields() {
        let fieldItems = services.billerRoot[billerRootIndex].billers[billerRootTypeIndex].fields;
        let html = "";
        for (var i = 0; i < fieldItems.length; i++) {
          let item = fieldItems[i];
          html += `
          <div class="form-group col-md-4">
            <label for="${item.id}">${item.name}</label>
            <input
              name="${item.id}" 
              max="${item.max}"
              min="${item.min}"
              type="${item.isnumeric ? "number" : "text"}" 
              maxlength="${item.maxLen}"
              pattern="${item.regex}" 
              class="form-control" 
              id="${item.id}" 
              required
              placeholder="${item.name}">
          </div>
          `;
        }
        document.querySelector("#fields").innerHTML = html;
      }
      async function getService(id) {
        try {
          document.querySelector(".services-name-dy h4").innerHTML = "";
          document.querySelector("#billerRoot select").innerHTML = "";
          document.querySelector("#mobileBillerRootType select").innerHTML = "";
          document.querySelector("#fields").innerHTML = "";
          document.querySelector("#bbps-submit-btn").innerHTML = "Fetch Bill";

          document.querySelector("#plansList").innerHTML = "";
          document.querySelector("#plansList").classList.add("d-none");

          document.querySelector("#billList").innerHTML = "";
          document.querySelector("#billList").classList.add("d-none");

          document.querySelector(".modal-services").classList.add("d-none");
          document.querySelector("#mobileRechargeCol").classList.add("d-none");

          document.querySelector("#educationList").classList.add("d-none");

          billerRootIndex = 0;
          billerRootTypeIndex = 0;
          document.querySelector("#mobileBillerRootType select").value = "";
          document.querySelector("#billerRoot select").value = "";

          // let response = await fetch("https://static.mobikwik.com/appdata/billerConfig_v4.json?v=1649318136");
          // response = await response.json();
          // let index = response.category.findIndex((x) => x.categoryId == id);

          let index = categories.findIndex((x) => x.categoryId == id);
          if (index > -1) {
            document.querySelector(".modal-services").classList.remove("d-none");
            service_id = id;

            // services = response.category[index];
            services = categories[index];
            document.querySelector(".services-name-dy h4").innerHTML = services.name + " payment";
            if (service_id === "Education") createEducationRoot();
            else setBillerRoot(services);
          } else {
            alert("Invalid Service");
          }
        } catch (error) {
          alert(error.message);
        }
      }
    </script>
    <!-- Mobile Recharge Extra Functions -->
    <script>
      async function fetchplans(serviceId) {
        try {
          let url, operator;
          let circle = document.querySelector("#mobileRechargeCircle select").value;
          let plan = document.querySelector("#mobileRechargePlans select").value;

          if (serviceId === "dth") operator = document.querySelector("#billerRoot select").value;
          else operator = document.querySelector("#mobileBillerRootType select").value;

          // if (!plan) alert("Please select plan");
          // else if (!circle) alert("Please select circle");

          if (!operator) alert("Please select type");
          else {
            operator = services.billerRoot[billerRootIndex].billers[billerRootTypeIndex].op;

            if (serviceId === "dth") url = `https://rapi.mobikwik.com/recharge/v1/rechargePlansAPI/${operator}`;
            else url = `https://rapi.mobikwik.com/recharge/v1/rechargePlansAPI/${operator}/${circle}`;

            let response = await fetch(url);
            response = await response.json();

            response = {
              success: true,
              data: {
                plans: [
                  {
                    id: "1028995",
                    operatorId: 1,
                    circleId: 19,
                    planType: 17,
                    planCode: "airtel-Rajasthan-local-plans-Rs-19.0",
                    amount: 19.0,
                    talktime: 0.0,
                    validity: "2 days",
                    planName: "Voice + 4G Data",
                    planDescription:
                      "Enjoy TRULY unlimited Local, STD & Roaming calls on  any network, 200 MB data for 2 days ",
                    dataBenefit: "200 MB",
                    isPopular: 0,
                    isPromoted: 0,
                    isHidden: 0,
                    stringTalktime: null,
                    special: true,
                    validityInDays: 2,
                    languageRegion: [""],
                    type: [""],
                    planTypeForWeb: 17,
                    planDetailItemList: [
                      {
                        key: "talktime",
                        displayName: "Talktime",
                        displayValue: "-",
                      },
                      {
                        key: "validity",
                        displayName: "Validity",
                        displayValue: "2 days",
                      },
                      {
                        key: "data",
                        displayName: "Data",
                        displayValue: "200 MB",
                      },
                    ],
                    planTypeList: [1, 17],
                  },
                ],
              },
            };

            if (response.success) {
              rechargePlans = response?.data?.plans;

              let html = "";
              for (var i = 0; i < rechargePlans.length; i++) {
                let item = rechargePlans[i];
                html += `
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">${item.planName}</h5>
                      <p class="card-text">${item.planDescription}</p>
                      <p class="card-text">Amount - ${item.amount}</p>
                      ${item.planDetailItemList
                        .map((tt) => {
                          return `<p class="card-text">${tt.displayName} :  ${tt.displayValue}</p>`;
                        })
                        .join("")}
                      <a onclick="selectRechargePlan('${i}')" href="#" class="btn btn-primary btn">Select</a>
                    </div>
                  </div>
                </div>
                `;
              }
              document.querySelector("#plansList").innerHTML = html;
              document.querySelector("#plansList").classList.remove("d-none");
            } else alert(response?.message?.text);
          }
        } catch (error) {
          alert(error.message);
        }
      }
      async function selectRechargePlan(index) {
        selectedPlanIndex = index;
        document.querySelector("input#amt").value = parseInt(rechargePlans[index].amount);
      }
    </script>
    <!-- Education -->
    <script>
      let cities = [],
        schools = [],
        selectedStateIndex = 0,
        selectedCityIndex = 0,
        selectedSchoolIndex = 0;
      async function createEducationRoot() {
        let html = "";
        for (var i = 0; i < states.length; i++) html += `<option value="${i}">${states[i].name}</option>`;
        document.querySelector("#statesList select").innerHTML = html;
        document.querySelector("#educationList").classList.remove("d-none");
        document.querySelector("#billerRoot").classList.add("d-none");
        stateSelected();
      }
      async function stateSelected() {
        let index = document.querySelector("#statesList select").value;
        selectedStateIndex = index ? index : 0;
        cities = states[index].cities;
        let html = "";
        for (var i = 0; i < cities.length; i++) html += `<option value="${i}">${cities[i].name}</option>`;
        document.querySelector("#citiesList select").innerHTML = html;
        citySelected();
      }
      async function citySelected() {
        let index = document.querySelector("#citiesList select").value;
        selectedCityIndex = index ? index : 0;
        schools = cities[index].schools;
        let html = "";
        for (var i = 0; i < schools.length; i++) html += `<option value="${i}">${schools[i].name}</option>`;
        document.querySelector("#schoolsList select").innerHTML = html;
      }
      async function schoolSelected() {
        let index = document.querySelector("#schoolsList select").value;
        selectedSchoolIndex = index ? index : 0;
      }
    </script>
    <!-- Form Submit -->
    <script>
      // sort object alphabetically
      function sortObjectByKeys(o) {
        return Object.keys(o)
          .sort()
          .reduce((r, k) => ((r[k] = o[k]), r), {});
      }

      async function doRecharge() {
        let operator = services.billerRoot[billerRootIndex].billers[billerRootTypeIndex].op;
        let cn = document.querySelector("input#cn").value;
        let circle = document.querySelector("#mobileRechargeCircle select").value;
        let amt = document.querySelector("input#amt").value;

        let body = {
          amt: String(amt),
          cir: String(circle),
          cn: cn,
          op: String(operator),
          pwd: "testalpha1@123",
          reqid: "10035403539",
          uid: "testalpha1@gmail.com",
        };

        body = sortObjectByKeys(body);
        const queryParams = new URLSearchParams(body).toString();
        let url = "https://alpha3.mobikwik.com/recharge.do?" + queryParams;

        try {
          let hash = CryptoJS.HmacSHA256(JSON.stringify(body), "abcd@123");
          let hashInBase64 = CryptoJS.enc.Base64.stringify(hash);

          let options = {
            method: "GET",
            headers: {
              checkSum: hashInBase64,
            },
          };

          let response = await fetch(url, options);
          response = await response.json();
          console.log(response);
        } catch (error) {
          alert(error.message);
        }
      }

      async function fetchBill(body) {
        let options = {
          method: "POST",
          body: JSON.stringify(body),
          headers: {
            "Content-Type": "application/json",
            "X-MClient": 14,
          },
        };
        try {
          // let response = await fetch("https://rapi.mobikwik.com/retailer/v2/viewbill", options);
          // response = await response.json();
          let response = {
            success: true,
            data: [
              {
                billNumber: "139177237",
                billAmount: "50.0",
                billnetamount: "50.0",
                billdate: "25 Apr 2022",
                dueDate: "25 Apr 2022",
                statusMessage: "1",
                acceptPayment: true,
                acceptPartPay: false,
                cellNumber: "9930149069",
              },
            ],
          };
          console.log(response);
          if (response.success) {
            let bills = response.data;
            let html = "";
            for (var i = 0; i < bills.length; i++) {
              let bill = bills[i];
              html += `
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6 class="card-title">Bill Number - ${bill.billNumber}</h6>
                    <h6 class="card-title">Bill Amount - ${bill.billAmount}</h6>
                    <h6 class="card-title">Phone Number - ${bill.cellNumber}</h6>
                    <h6 class="card-title">Due Date - ${bill.dueDate}</h6>
                    <a onclick="payBill('${i}')" href="#" class="btn btn-primary btn">Pay Bill</a>
                  </div>
                </div>
              </div>
              `;
            }
            document.querySelector("#billList").innerHTML = html;
            document.querySelector("#billList").classList.remove("d-none");
          } else alert(response.message.text);
        } catch (error) {
          alert(error.message);
        }
      }
      async function payBill(index) {
        let bill = bills[index];
      }
      async function formSubmit(e) {
        e.preventDefault();
        let body = {};
        let operator = services.billerRoot[billerRootIndex].billers[billerRootTypeIndex].op;
        let cn = document.querySelector("input#cn").value;
        let emailId = document.querySelector("input#emailId") && document.querySelector("input#emailId").value;

        if (service_id === "mobile") doRecharge();
        else if (service_id === "Education") {
          body = {
            adParams: {
              instituteName: "EDU001915BIH01",
              "Mobile Number of Parent": "8182913888",
              "DOB Of Student": "18071997",
              viewBill: "true",
            },
            cir: "",
            cn: cn,
            op: operator,
          };
          fetchBill(body);
        } else if (service_id === "insurance" && Number(op) === 525) {
          body = {
            adParams: { emailId: emailId },
            cir: "",
            cn: cn,
            op: operator,
          };
          fetchBill(body);
        } else {
          body = {
            adParams: {},
            cn: cn,
            op: operator,
          };
          fetchBill(body);
        }
      }
    </script>
  </body>
</html>
